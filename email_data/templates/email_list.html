{% extends 'base.html' %}

{% block meta %}
<title>Email List</title>
{% endblock meta %}

{% block content %}



<h1 class="text-2xl font-semibold m-10">Email List</h1>

<div class="overflow-x-auto relative">
    <div class="flex justify-between">
        <div class="flex items-center">
            <div id="pagination" class="flex items-center"></div>
        </div>
    </div>


    <table class="table" id="emailTable">
        <thead class="bg-neutral-900 text-white">
            <tr>
                <th></th>
                <th>Name</th>
                <th>Email</th>
                <th>Department</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for email in emails %}
            <tr>
                <th>{{ forloop.counter }}</th>
                <td class="text-blue-700">{{ email.nama }} </td>
                <td>{{ email.email }}</td>
                <td>{{ email.group }}</td>
                <td>
                    <a href="{% url 'email_data:email_update' email.email %}"
                        class="btn btn-sm btn-primary rounded-lg text-white">Edit</a>
                    <button class="btn btn-sm btn-error rounded-lg text-white delete-link"
                        onclick="showDeleteModal(event)">Delete</button>

                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <dialog id="my_modal_1" class="modal">
        <div class="modal-box">
            <h3 class="font-bold text-lg">Confirm Deletion</h3>
            <p class="py-4">Are you sure you want to delete <span id="deleteEmail"></span>?</p>
            <div class="modal-action">
                <form method="post" id="deleteForm">
                    {% csrf_token %}
                    <button class="btn btn-error rounded-lg text-white" id="confirmDeleteButton">Confirm</button>
                    <button class="btn btn-neutral rounded-lg text-white" onclick="my_modal_1.close()">Cancel</button>
                </form>
            </div>
        </div>
    </dialog>


</div>

<a href="{% url 'email_data:email_create' %}" class="btn btn-primary ml-5 text-white rounded-lg p-3">Add new email</a>



<script>
    $(document).ready(function () {
        var table = $('#emailTable').DataTable({
            "lengthChange": false,
            "pageLength": 10,
            "info": false,
            "language": {
                "paginate": {
                    "previous": "Prev",
                    "next": "Next"
                }
            }
        });
    });


    function showDeleteModal(event) {
        event.preventDefault();
        var email = $(event.target).closest('tr').find('td:eq(1)').text();
        $('#deleteEmail').text(email);
        my_modal_1.showModal();
    }

    $('#confirmDeleteButton').on('click', function (event) {
        event.preventDefault();
        var email = $('#deleteEmail').text();
        var url = '/email-data/email/' + encodeURIComponent(email) + '/delete/';
        $.ajax({
            url: url,
            type: 'POST',
            data: $('#deleteForm').serialize(),
            success: function (response) {

                my_modal_1.close();
                location.reload();
            },
            error: function (xhr, status, error) {
                // Handle error
                console.error(xhr.responseText);
                alert('Error occurred. Please try again.');
            }
        });
    });




</script>

<style>
    .dt-container {
        margin: 2.5rem;

    }

    .dataTables_wrapper .dataTables_paginate .paginate_button {
        padding: 5px 10px;
        margin-right: 5px;
        border: 1px solid #ccc;
        border-radius: 3px;
        background-color: #fff;
        color: #333;
    }

    /* Style untuk input pencarian */
    .dt-search {
        margin-bottom: 10px;
        /* Tambahkan margin agar tidak rapat dengan tabel */
        display: flex;
        align-items: center;
        width: 100%;
    }

    .dt-search label {
        margin-right: 10px;
        font-weight: 600;

    }

    .dt-search input[type="search"] {
        width: 20%;

    }

    /* Style untuk modal */
    .modal {
        z-index: 1;
        /* Menempatkan modal di atas konten lain */
    }

    .modal-content {
        width: 400px;
        background-color: #fff;
    }

    .hidden {
        display: none;
        /* Menyembunyikan elemen */
    }
</style>
{% endblock content %}